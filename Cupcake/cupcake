#!/bin/bash

# mocaccino cupcake bash script
# build a dotnet solution
# version 0.0.1

buildCoreProject() {

	echo -e "\n üìÇ Scaffold of core project under construction.\n"

	cd src

    mkdir core
    cd core
    dotnet new classlib -f netstandard2.1 --name $solutionName.Domain
    dotnet new classlib -f netstandard2.1 --name $solutionName.Application
    cd $solutionName.Domain \
        && mkdir Entities \
       	&& mkdir Enums
    cd ../$solutionName.Application \
        && dotnet add reference ../$solutionName.Domain/$solutionName.Domain.csproj

    cd ../..
}


buildInfrastructureProject() {

	echo -e "\n üìÇ Scaffold of infrastructure project under construction.\n"

	mkdir infrastructure
    cd infrastructure
    dotnet new classlib -f net5.0 --name $solutionName.Data
    dotnet new classlib -f net5.0 --name $solutionName.Shared
    cd $solutionName.Data \
        && mkdir Contexts \
        && dotnet add reference ../../core/$solutionName.Domain/$solutionName.Domain.csproj \
        && dotnet add reference ../../core/$solutionName.Application/$solutionName.Application.csproj
    dotnet add package Microsoft.EntityFrameworkCore.Sqlite
    cd ../$solutionName.Shared \
        && dotnet add reference ../../core/$solutionName.Application/$solutionName.Application.csproj

    cd ../..
}


buildPresentationProject() {

	echo -e "\n üìÇ Scaffold of presentation project under construction.\n"

	mkdir presentation
    cd presentation
    dotnet new webapi --name $solutionName.WebApi \
        && cd $solutionName.WebApi \
        && dotnet add reference ../../core/$solutionName.Application/$solutionName.Application.csproj \
        && dotnet add reference ../../infrastructure/$solutionName.Data/$solutionName.Data.csproj \
        && dotnet add reference ../../infrastructure/$solutionName.Shared/$solutionName.Shared.csproj \
        && dotnet add package Microsoft.EntityFrameworkCore.Design \
        && dotnet add package Microsoft.EntityFrameworkCore.Sqlite

    cd ../../..
}

addingProjectsToTheSolution() {

	echo -e "\n ‚ûï Now all projects will be added to the solution.\n"

    dotnet sln add src/core/$solutionName.Domain/$solutionName.Domain.csproj
    dotnet sln add src/core/$solutionName.Application/$solutionName.Application.csproj
    dotnet sln add src/infrastructure/$solutionName.Data/$solutionName.Data.csproj
    dotnet sln add src/infrastructure/$solutionName.Shared/$solutionName.Shared.csproj
    dotnet sln add src/presentation/$solutionName.WebApi/$solutionName.WebApi.csproj
}

buildSolution() {
	# todo
	solutionName=$1
	echo -e "\n üÜï Scaffold of new solution: \"$solutionName\" under construction\n"
	
	buildCoreProject $solutionName
	buildInfrastructureProject $solutionName
	buildPresentationProject $solutionName
	addingProjectsToTheSolution $solutionName
	
	echo -e "\n üÜó Well, a solution .NET named: \"$solutionName\" has just been generated.\n"
}

main() {
	if [ "$1" != '' ]; then
		buildSolution $1
	else
    		echo -e "\n ‚ùå I am sorry, you forgot to pass the solution name!\n"
	fi
}

# passing one argument to the main function

main $1
